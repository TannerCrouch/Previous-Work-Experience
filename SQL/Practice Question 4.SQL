CREATE TABLE mytable(
   PRODUCT    VARCHAR(6) NOT NULL 
  ,WEEKNUMBER INTEGER  NOT NULL
  ,SALES      INTEGER  NOT NULL
);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('HAMMER',1,17);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('HAMMER',2,20);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('HAMMER',3,17);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('HAMMER',4,10);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('HAMMER',5,12);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('HAMMER',6,13);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('HAMMER',7,2);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('HAMMER',8,25);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('SINK',1,25);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('SINK',2,20);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('SINK',3,9);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('SINK',4,7);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('SINK',5,24);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('SINK',6,16);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('SINK',7,10);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('SINK',8,16);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('BUCKET',1,22);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('BUCKET',2,2);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('BUCKET',3,10);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('BUCKET',4,24);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('BUCKET',5,9);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('BUCKET',6,20);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('BUCKET',7,9);
INSERT INTO mytable(PRODUCT,WEEKNUMBER,SALES) VALUES ('BUCKET',8,21);


WITH DataTable AS(
SELECT product, weeknumber, sales, SUM(SALES) OVER (PARTITION BY PRODUCT ordeR by weeknumber rows BETWEEN 3 preceding and Current Row) as TOTAL_SALES
FROM mytable),
AlmostDone AS(
SELECT product, MAX(TOTAL_SALES) AS BEST_CONSEC_4WEEKS_SLS, weeknumber - COALESCE(lag(weeknumber,3) over (order by weeknumber),3)as Starting_week, weeknumber AS Ending_week
FROM DataTable
GROUP BY product)

SELECT product, BEST_CONSEC_4WEEKS_SLS, (Starting_week ||'-'|| Ending_week) AS BEST_CONSEC_4WEEKS FROM AlmostDone
